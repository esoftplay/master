var a=document.createElement("script");a.setAttribute("src","https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"),document.head.appendChild(a);var pXls={};_Bbc(function(a){a(".fa-lg",a(".roll-export")).on("click",function(b){b.preventDefault();var c=a(this).attr("rel").split("="),d=c[0],e=decodeURIComponent(c[1].replace(/\+/g," ")),h=a(this).data("type"),i=a(".export_all",a(this).closest(".roll-export")),j=a(i).data("page"),k=a(i).data("form"),l=null,m=document.location.href;i.is(":checked")?(l=new RegExp("([?&]"+j+"=[0-9]+)","g"),m=m.replace(l,""),e=e.substring(0,e.lastIndexOf(" - Page")+1),page=1):(l=new RegExp("[?&]"+j+"=([0-9]+)","g"),X=l.exec(m),page=1,null!=X&&0<X[1]&&(page=X[1])),m+=m.match(/\?/)?"&":"?",m+=k+"_export_all=",m+=i.is(":checked")?"1":"0",m+="&"+k+"_export_type="+h,m+="&"+j+"=",f="<div class=\"modal fade\" tabindex=\"-1\" role=\"dialog\" id=\"export_"+k+"\"><div class=\"modal-dialog\" role=\"document\"><div class=\"modal-content\"><div class=\"modal-header\"><button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button><h4 class=\"modal-title\">Extracting Data..</h4></div><div class=\"modal-body\"></div><div class=\"modal-footer\"><button type=\"button\" class=\"btn btn-default btn-secondary\" data-dismiss=\"modal\">Cancel</button></div></div></div></div>",a(document.body).append(f);var n=a("#export_"+k),o=a(".modal-body",n);n.on("show.bs.modal",function(){window[a(this).prop("id")]=!0}).on("hide.bs.modal",function(){window[a(this).prop("id")]=!1,a(this).remove()}),n.modal("show"),pXls={tot:{header:0,rows:0},data:{header:[],body:[]}},g(m,page,n,o,d,e.trim(),h)}),a(".fa-lg",a(".edit-export")).on("click",function(b){b.preventDefault();var e=a(this).data("title").replace(/\+/g," ").trim(),g=a(this).data("type"),h=a(this).data("form"),i=document.location.href;i+=i.match(/\?/)?"&":"?",i+="&"+h+"_export_type="+g,console.log(i),a.ajax(i,{success:function(a){if(a.data){output="","html"==g&&(output=c(e)),output+=a.data,"html"==g?(output+=d(),ext="html"):ext="csv";var h=new Blob([output],{type:"text/"+ext}),i=window.URL.createObjectURL(h),j=document.createElement("a");j.setAttribute("href",i),j.setAttribute("download",e+"."+ext),j.click()}}})});var c=function(a){return"<!DOCTYPE html><html lang=\"en\"><head><meta charset=\"utf-8\"><meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"><title>"+a+"</title><link href=\""+_URL+"templates/admin/bootstrap/css/bootstrap.min.css\" rel=\"stylesheet\" /><script type=\"text/javascript\">var _ROOT=\""+_ROOT+"\";var _URL=\""+_URL+"\";function _Bbc(a,b){var c=\"BS3load_func\";if(!window[c+\"i\"]){window[c+\"i\"]=0};window[c+\"i\"]++;if(!b){b=c+\"i\"+window[c+\"i\"]};if(!window[c]){window[c]=b}else{window[c]+=\",\"+b}window[b]=a;if(typeof BS3!=\"undefined\"){window[b](BS3)}};</script></head><body><table class=\"table table-striped table-bordered table-hover\">"},d=function(){return"</tbody></table><script src=\""+_URL+"templates/admin/bootstrap/js/bootstrap.min.js\"></script></body></html>"},e=function(a){return!("string"!=typeof a)&&!isNaN(a)&&!isNaN(parseFloat(a))},g=function(h,i,j,k,l,m,n){a.ajax(h+i,{global:!1,success:function(o){if(!window[a(j).prop("id")])delete window[l];else if("undefined"!=typeof o.done)if(k.html("<div class=\"progress\"><div class=\"progress-bar\" role=\"progressbar\" aria-valuenow=\"<?php echo $done ?>\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width:"+o.done+"%\"> "+o.done+"% </div></div>"),"undefined"==typeof window[l]&&(window[l]="","html"==n&&(window[l]=c(m))),window[l]+=o.data,"html"!=n&&(1e6>pXls.tot.rows?(o.data.split("\"\n").forEach(a=>{row=[],a+="\"",a.split("\",\"").forEach(a=>{a=a.replace(/^"/,""),a=a.replace(/"$/,""),a=a.replace(/\r/g,""),a=a.replace(/_x000d_/g,""),a=a.replace(/""/g,"\""),a=a.replace(/\\"/g,"\""),a&&(e(a)&&11>a.length&&"0"!=a[0]&&(a=parseInt(a)),row.push(a))}),0<row.length&&(0==pXls.tot.header?(pXls.tot.header++,pXls.data.header.push(row)):(pXls.tot.rows++,pXls.data.body.push(row)))}),ext="xlsx"):ext="csv"),100>o.done)g(h,++i,j,k,l,m,n);else{if("html"==n?(window[l]+=d(),ext="html"):"xlsx"==ext&&"undefined"==typeof XLSX&&(ext="csv"),"xlsx"==ext){const a=XLSX.utils.json_to_sheet(pXls.data.body),b=XLSX.utils.book_new();XLSX.utils.book_append_sheet(b,a,"Sheet 1"),XLSX.utils.sheet_add_aoa(a,pXls.data.header,{origin:"A1"}),XLSX.writeFile(b,m+"."+ext,{compression:!0})}else{var p=new Blob([window[l]],{type:"text/"+ext}),q=window.URL.createObjectURL(p),r=document.createElement("a");r.setAttribute("href",q),r.setAttribute("download",m+"."+ext),r.click()}j.modal("hide"),delete window[l]}}})}});