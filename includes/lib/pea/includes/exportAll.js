var a=document.createElement("script");a.setAttribute("src","https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"),document.head.appendChild(a);var pXls={};_Bbc((function(t){t(".fa-lg",t(".roll-export")).on("click",(function(e){e.preventDefault();var a=t(this).attr("rel").split("="),i=a[0],d=decodeURIComponent(a[1].replace(/\+/g," ")),l=t(this).data("type"),s=t(".export_all",t(this).closest(".roll-export")),n=t(s).data("page"),r=t(s).data("form"),c=null,p=document.location.href;s.is(":checked")?(c=new RegExp("([?&]"+n+"=[0-9]+)","g"),p=p.replace(c,""),d=d.substring(0,d.lastIndexOf(" - Page")+1),page=1):(c=new RegExp("[?&]"+n+"=([0-9]+)","g"),X=c.exec(p),page=1,null!=X&&X[1]>0&&(page=X[1])),p+=p.match(/\?/)?"&":"?",p+=r+"_export_all=",p+=s.is(":checked")?"1":"0",p+="&"+r+"_export_type="+l,p+="&"+n+"=",f='<div class="modal fade" tabindex="-1" role="dialog" id="export_'+r+'"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">Extracting Data..</h4></div><div class="modal-body"></div><div class="modal-footer"><button type="button" class="btn btn-default btn-secondary" data-dismiss="modal">Cancel</button></div></div></div></div>',t(document.body).append(f);var h=t("#export_"+r),u=t(".modal-body",h);h.on("show.bs.modal",(function(e){window[t(this).prop("id")]=!0})).on("hide.bs.modal",(function(e){window[t(this).prop("id")]=!1,t(this).remove()})),h.modal("show"),pXls={tot:{header:0,rows:0},data:{header:[],body:[]}},o(p,page,h,u,i,d.trim(),l)})),t(".fa-lg",t(".edit-export")).on("click",(function(o){o.preventDefault();var i=t(this).data("title").replace(/\+/g," ").trim(),d=t(this).data("type"),l=t(this).data("form"),s=document.location.href;s+=s.match(/\?/)?"&":"?",s+="&"+l+"_export_type="+d,console.log(s),t.ajax(s,{success:function(t){if(t.data){output="","html"==d&&(output=e(i)),output+=t.data,"html"==d?(output+=a(),ext="html"):ext="csv";var o=new Blob([output],{type:"text/"+ext}),l=window.URL.createObjectURL(o),s=document.createElement("a");s.setAttribute("href",l),s.setAttribute("download",i+"."+ext),s.click()}}})}));var e=function(t){return'<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>'+t+'</title><link href="'+_URL+'templates/admin/bootstrap/css/bootstrap.min.css" rel="stylesheet" /><script type="text/javascript">var _ROOT="'+_ROOT+'";var _URL="'+_URL+'";function _Bbc(a,b){var c="BS3load_func";if(!window[c+"i"]){window[c+"i"]=0};window[c+"i"]++;if(!b){b=c+"i"+window[c+"i"]};if(!window[c]){window[c]=b}else{window[c]+=","+b}window[b]=a;if(typeof BS3!="undefined"){window[b](BS3)}};<\/script></head><body><table class="table table-striped table-bordered table-hover">'},a=function(){return'</tbody></table><script src="'+_URL+'templates/admin/bootstrap/js/bootstrap.min.js"><\/script></body></html>'},o=function(i,d,l,s,n,r,c){t.ajax(i+d,{global:!1,success:function(p){if(window[t(l).prop("id")]){if(void 0!==p.done)if(s.html('<div class="progress"><div class="progress-bar" role="progressbar" aria-valuenow="<?php echo $done ?>" aria-valuemin="0" aria-valuemax="100" style="width:'+p.done+'%"> '+p.done+"% </div></div>"),void 0===window[n]&&(window[n]="","html"==c&&(window[n]=e(r))),window[n]+=p.data,"html"!=c&&(pXls.tot.rows<1e6?(p.data.split('"\n').forEach((t=>{row=[],(t+='"').split('","').forEach((t=>{(t=(t=(t=(t=(t=(t=t.replace(/^"/,"")).replace(/"$/,"")).replace(/\r/g,"")).replace(/_x000d_/g,"")).replace(/""/g,'"')).replace(/\\"/g,'"'))&&row.push(t)})),row.length>0&&(0==pXls.tot.header?(pXls.tot.header++,pXls.data.header.push(row)):(pXls.tot.rows++,pXls.data.body.push(row)))})),ext="xlsx"):ext="csv"),p.done<100)o(i,++d,l,s,n,r,c);else{if("html"==c?(window[n]+=a(),ext="html"):"xlsx"==ext&&"undefined"==typeof XLSX&&(ext="csv"),"xlsx"==ext){const t=XLSX.utils.json_to_sheet(pXls.data.body),e=XLSX.utils.book_new();XLSX.utils.book_append_sheet(e,t,"Sheet 1"),XLSX.utils.sheet_add_aoa(t,pXls.data.header,{origin:"A1"}),XLSX.writeFile(e,r+"."+ext,{compression:!0})}else{var h=new Blob([window[n]],{type:"text/"+ext}),u=window.URL.createObjectURL(h),w=document.createElement("a");w.setAttribute("href",u),w.setAttribute("download",r+"."+ext),w.click()}l.modal("hide"),delete window[n]}}else delete window[n]}})}}));